<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.glxy.sass.mapper.EnrollMapper">

    <insert id="add" parameterType="org.glxy.sass.entity.Enroll">
        insert into
        enroll(enroll_id,competition_nb,competition_ne,competition_start,competition_end,competition_site,users_stnumber,users_name,users_sex,users_phone,college_name)
        value
        (#{enrollId},#{competitionNb},#{competitionNe},#{competitionStart},#{competitionEnd},#{competitionSite},#{usersStnumber},#{usersName},#{usersSex},#{usersPhone},#{collegeName})
    </insert>

    <!--    根据学号删除-->
    <delete id="deleteEnUsersStnumber" parameterType="org.glxy.sass.entity.Enroll">
        DELETE FROM enroll
        WHERE users_stnumber = #{usersStnumber}
    </delete>

    <!--    根据比赛编号删除-->
    <delete id="deleteEnCompetitionNb" parameterType="org.glxy.sass.entity.Enroll">
        DELETE FROM enroll
        WHERE competition_nb = #{competitionNb}
    </delete>

    <!--    查询表中数据是否重复-->
    <select id="selectRepeat" resultType="org.glxy.sass.entity.Enroll">
        SELECT competition_nb,users_stnumber FROM enroll
        WHERE competition_nb = #{competitionNb} and users_stnumber = #{usersStnumber}
    </select>

    <!--    条件查询-->
    <select id="selectAll" resultType="org.glxy.sass.entity.Enroll">
        select * from enroll
        <where>
            <if test="competitionNe != null and competitionNe != '' ">
                AND competition_ne LIKE CONCAT('%','${competitionNe}','%')
            </if>
            <if test="collegeName != null and collegeName != '' ">
                AND college_name LIKE CONCAT('%','${collegeName}','%')
            </if>
            <if test="usersName != null and usersName != '' ">
                AND users_name LIKE CONCAT('%','${usersName}','%')
            </if>
        </where>
    </select>

    <!--    用户根据自己的学号获取报名列表-->
    <select id="selectBySber" resultType="org.glxy.sass.entity.Enroll">
        SELECT * FROM applicationform
	    LEFT JOIN competition ON competition.competition_nb = applicationform.competition_nb
	    WHERE applicationform.users_stnumber = #{usersStnumber}
    </select>

    <!--    获取用户报名比赛个数-->
    <select id="selectSber" resultType="java.util.Map">
        SELECT competition.competition_end FROM applicationform
		INNER JOIN competition ON applicationform.competition_nb = competition.competition_nb
        WHERE users_stnumber = #{usersStnumber} and competition_end &gt; CURRENT_TIMESTAMP ()
    </select>

</mapper>